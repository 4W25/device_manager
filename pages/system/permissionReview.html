<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>群組權限覆核</title>

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
<link rel="stylesheet" href="../../plugins/fontawesome-free/css/all.min.css">
<link rel="stylesheet" href="../../plugins/select2/css/select2.min.css">
<link rel="stylesheet" href="../../plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css">
<link rel="stylesheet" href="../../dist/css/adminlte.min.css">

<style>
/* 強制紫色主題的Select2樣式 */
.select2-container--bootstrap4.select2-purple .select2-selection--multiple {
  background-color: #6f42c1 !important;
  border-color: #6f42c1 !important;
  cursor: default;
  pointer-events: none;
}
.select2-container--bootstrap4 .select2-selection__choice {
  background-color: #7950f2 !important;
  border: none !important;
  color: #fff !important;
  padding: 2px 5px !important;
  margin-right: 5px !important;
}
.select2-container--bootstrap4 .select2-dropdown.select2-purple .select2-results__option--highlighted {
  background-color: #6f42c1 !important;
  color: #fff !important;
}
.select2-container--bootstrap4 .select2-dropdown.select2-purple .select2-results__option[aria-selected="true"] {
  background-color: #7950f2 !important;
  color: #fff !important;
}

/* 置中勾選欄位 */
td.text-center, th.text-center { vertical-align: middle !important; }
</style>
</head>

<body class="hold-transition sidebar-mini">
<div class="wrapper">
  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <ul class="navbar-nav">
      <li class="nav-item"><a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a></li>
      <li class="nav-item d-none d-sm-inline-block"><a href="../../index.html" class="nav-link">回首頁</a></li>
    </ul>
    <ul class="navbar-nav ml-auto">
      <li class="nav-item"><a class="nav-link" data-widget="fullscreen" href="#" role="button"><i class="fas fa-expand-arrows-alt"></i></a></li>
    </ul>
  </nav>

  <!-- Sidebar -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4">
    <a href="../../index.html" class="brand-link">
      <img src="../../dist/img/device01.png" class="brand-image img-circle elevation-3" style="opacity: .8">
      <span class="brand-text font-weight-light">自動化設備管理平臺</span>
    </a>
    <div class="sidebar">
      <div class="user-panel mt-3 pb-3 mb-3 d-flex">
        <div class="image"><img src="../../dist/img/userNobody.png" class="img-circle elevation-2"></div>
        <div class="info"><a href="#" class="d-block">登入者姓名</a></div>
      </div>
      <nav class="mt-2">
        <ul id="sidebarMenu" class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false"></ul>
      </nav>
    </div>
  </aside>

  <!-- Content -->
  <div class="content-wrapper">
    <section class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6"><h1>權限設定覆核</h1></div>
          <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
              <li class="breadcrumb-item"><a href="../../index.html">首頁</a></li>
              <li class="breadcrumb-item active">基本管理 / 權限設定覆核</li>
            </ol>
          </div>
        </div>
      </div>
    </section>

    <section class="content">
      <div class="container-fluid">
        <div class="card card-outline card-primary">
          <div class="card-header">
            <h3 class="card-title"><i class="fas fa-user-shield mr-2"></i>群組權限設定覆核</h3>
          </div>

          <!-- 批次操作按鈕 -->
          <div class="card-body mb-2">
            <button class="btn btn-success btn-batch-approve"><i class="fas fa-check"></i> 通過</button>
            <!--<button class="btn btn-danger btn-batch-reject"><i class="fas fa-times"></i> 批次退回</button>-->
          </div>

          <table class="table table-bordered table-hover" id="reviewTable">
            <thead class="thead-light">
              <tr>
                <th class="text-center" style="width: 40px;"><input type="checkbox" id="checkAll"></th>
                <th>群組代號</th>
                <th>群組名稱</th>
                <th>申請者</th>
                <th>申請時間</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              <!-- 假資料 -->
              <tr>
                <td class="text-center"><input type="checkbox" class="row-check" data-id="SYSTEM"></td>
                <td>SYSTEM</td>
                <td>系統管理員</td>
                <td>王小明</td>
                <td>2025/01/12 14:32:55</td>
                <td>
                  <button class="btn btn-info btn-sm btn-expand" data-target="#details1">展開</button>
                  <!--<button class="btn btn-success btn-sm btn-approve">通過</button>-->
                  <button class="btn btn-danger btn-sm btn-reject">退回</button>
                </td>
              </tr>
              <tr class="collapse" id="details1">
                <td colspan="6">
                  <div class="permission-container readonly-select2">
                    <label>系統管理</label>
                    <select class="form-control select2" multiple="multiple" disabled>
                      <option selected>使用者管理</option>
                      <option selected>群組設定</option>
                      <option selected>權限控管</option>
                      <option selected>選單維護</option>
                    </select>
                    <label class="mt-2">設備管理</label>
                    <select class="form-control select2" multiple="multiple" disabled>
                      <option selected>設備清冊</option>
                      <option selected>維護紀錄</option>
                      <option selected>版本控管</option>
                    </select>
                    <label class="mt-2">報表分析</label>
                    <select class="form-control select2" multiple="multiple" disabled>
                      <option selected>設備運作報表</option>
                      <option selected>異常統計報表</option>
                    </select>
                  </div>
                </td>
              </tr>

              <!-- 其他假資料可依樣增加 -->
            </tbody>
          </table>

        </div>
      </div>
    </section>
  </div>

  <footer class="main-footer">
    <div class="float-right d-none d-sm-block"><b>Version</b> 3.2.0</div>
    <strong>Copyright &copy; <a href="https://www.leosys.com/">國眾電腦股份有限公司</a>.</strong> All rights reserved.
  </footer>
</div>

<script src="../../plugins/jquery/jquery.min.js"></script>
<script src="../../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="../../plugins/select2/js/select2.full.min.js"></script>
<script src="../../dist/js/adminlte.min.js"></script>
<script src="../../data/sidebar_menu.js"></script>
<script src="../../js/sidebar.js"></script>

<script>
$(function(){

  // 初始化 Select2
  $('.select2').select2({theme:'bootstrap4', dropdownCssClass:'select2-purple', disabled:true});

  // 展開 / 收合
  $(document).on("click", ".btn-expand", function(e){
    e.stopPropagation();
    const target = $(this).data("target");
    $(target).collapse('toggle');
    $(target).off('shown.bs.collapse hidden.bs.collapse');
    $(target).on('shown.bs.collapse', () => $(e.currentTarget).text('收合'));
    $(target).on('hidden.bs.collapse', () => $(e.currentTarget).text('展開'));
  });

  // 單筆通過
  $(document).on("click",".btn-approve",function(e){
    e.stopPropagation();
    alert("審核已通過！（此為示意功能，可串接 API）");
  });

  // 單筆退回
  $(document).on("click",".btn-reject",function(e){
    e.stopPropagation();
    const reason = prompt("請輸入退回原因：");
    if(reason) alert("已退回，原因：" + reason);
  });

  // 全選 / 單選同步
  $(document).on("change","#checkAll",function(){
    $(".row-check").prop("checked",$(this).prop("checked"));
  });
  $(document).on("change",".row-check",function(){
    const total=$(".row-check").length;
    const checked=$(".row-check:checked").length;
    $("#checkAll").prop("checked", total===checked);
  });

  // 批次通過
  $(".btn-batch-approve").click(function(){
    const selected=$(".row-check:checked");
    if(selected.length===0){ alert("請先勾選！"); return; }
    selected.each(function(){
      $(this).closest("tr").find(".btn-approve").click();
    });
  });

  // 批次退回
  $(".btn-batch-reject").click(function(){
    const selected=$(".row-check:checked");
    if(selected.length===0){ alert("請先勾選！"); return; }
    selected.each(function(){
      $(this).closest("tr").find(".btn-reject").click();
    });
  });

});
</script>
</body>
</html>
